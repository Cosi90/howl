# Patch by SÃ©bastien Granjoux to avoid flickering on Gtk+-3 >= 3.9.2
# See Scintilla issue for more information:
#
# https://sourceforge.net/p/scintilla/bugs/1567
diff -r 453d4ae3e05c gtk/ScintillaGTK.cxx
--- a/gtk/ScintillaGTK.cxx	Sun Feb 02 18:15:20 2014 +1100
+++ b/gtk/ScintillaGTK.cxx	Sat Feb 08 09:46:06 2014 +0100
@@ -756,10 +756,10 @@
 #else
 	g_signal_connect(G_OBJECT(widtxt), "expose_event",
 			   G_CALLBACK(ScintillaGTK::ExposeText), this);
+	// Avoid background drawing flash
+	gtk_widget_set_double_buffered(widtxt, FALSE);
 #endif
 	gtk_widget_set_events(widtxt, GDK_EXPOSURE_MASK);
-	// Avoid background drawing flash
-	gtk_widget_set_double_buffered(widtxt, FALSE);
 	gtk_widget_set_size_request(widtxt, 100, 100);
 	adjustmentv = GTK_ADJUSTMENT(gtk_adjustment_new(0.0, 0.0, 201.0, 1.0, 20.0, 20.0));
 #if GTK_CHECK_VERSION(3,0,0)
@@ -2425,6 +2425,13 @@
 		    GTK_CONTAINER(PWidget(wMain)), PWidget(scrollbarh), cr);
 		gtk_container_propagate_draw(
 		    GTK_CONTAINER(PWidget(wMain)), PWidget(scrollbarv), cr);
+// Starting from the following version, the expose event are not propagated
+// for double buffered non native windows, so we need to call it ourselves
+// or keep the default handler
+#if GTK_CHECK_VERSION(3,9,2)
+		gtk_container_propagate_draw(
+		    GTK_CONTAINER(PWidget(wMain)), PWidget(wText), cr);
+#endif
 	} catch (...) {
 		errorStatus = SC_STATUS_FAILURE;
 	}
