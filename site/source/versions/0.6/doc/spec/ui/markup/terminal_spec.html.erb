---
title: Spec - howl.ui.markup.terminal
tags: spec
---
<div class="spec-group spec-group-1">

<h1 id="howl.ui.markup.terminal">howl.ui.markup.terminal</h1>

<h4 id="returns-a-styledtext-instance-with-empty-styles-if-no-markup-is-detected">returns a StyledText instance with empty styles if no markup is detected</h4>

<pre class="highlight moonscript"><code><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="nc">StyledText</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span><span class="w"> </span><span class="p">{}),</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'foo'</span></code></pre>

<div class="spec-group spec-group-2">

<h3 id="(ansi-escape-sequences)">(ANSI escape sequences)</h3>

<h4 id="handles-bold">handles bold</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'foo'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_bold'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[1mfoo\027[0m'</span></code></pre>


<h4 id="handles-italic">handles italic</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'foo'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_italic'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[3mfoo\027[0m'</span></code></pre>


<h4 id="handles-underline">handles underline</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'foo'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_underline'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[4mfoo\027[0m'</span></code></pre>


<h4 id="handles-background-colors">handles background colors</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'foo'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_red'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[31mfoo\027[0m'</span></code></pre>


<h4 id="handles-background-colors">handles background colors</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'foo'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_on_red'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[41mfoo\027[0m'</span></code></pre>


<h4 id="handles-combined-foreground-and-background-colors">handles combined foreground and background colors</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'foo'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_green_on_red'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[41;32mfoo\027[0m'</span></code></pre>


<h4 id="styles-remain-in-effect-until-resetted">styles remain in effect until resetted</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'foobar'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_on_red'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w">
  </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_green_on_red'</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[41mfoo\027[32mbar\027[0m'</span></code></pre>


<h4 id="handles-empty-reset-sequences">handles empty reset sequences</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'foobar'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_italic'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[3mfoo\027[mbar'</span></code></pre>


<h4 id="handles-prematurely-terminated-sequences">handles prematurely terminated sequences</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'foo'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_red'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[31mfoo'</span></code></pre>


<h4 id="handles-foreground-color-resetting">handles foreground color resetting</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'foobar'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_red'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[31mfoo\027[39mbar'</span></code></pre>


<h4 id="handles-background-color-resetting">handles background color resetting</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'foobar'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_on_red'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[41mfoo\027[49mbar'</span></code></pre>


<h4 id="skips-over-unhandled-escape-sequences">skips over unhandled escape sequences</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'foo'</span><span class="p">,</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[2,2Hfoo'</span></code></pre>


<h4 id="ignores-unhandled-graphic-parameters">ignores unhandled graphic parameters</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'foo'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_red'</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[31;5;6mfoo\027[m'</span></code></pre>

</div>
<div class="spec-group spec-group-2">

<h3 id="(backspace-characters-(bs))">(backspace characters (BS))</h3>

<h4 id="deletes-back-properly">deletes back properly</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'fo'</span><span class="p">,</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'foo\008'</span></code></pre>


<h4 id="deletes-a-utf-8-code-point-back,-and-not-a-byte">deletes a UTF-8 code point back, and not a byte</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'åä'</span><span class="p">,</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'åäö\008'</span></code></pre>


<h4 id="bs-at-the-start-of-the-text-is-left-alone">BS at the start of the text is left alone</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'\008foo'</span><span class="p">,</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\008foo'</span></code></pre>


<h4 id="updates-the-styling-accordingly">updates the styling accordingly</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'fobar'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">'ansi_red'</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'\027[31mfoo\027[m\008bar'</span></code></pre>


<h4 id="removes-any-left-empty-styling">removes any left empty styling</h4>

<pre class="highlight moonscript"><code><span class="n">expected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StyledText</span><span class="w"> </span><span class="s1">'fobar'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="n">assert</span><span class="p">.</span><span class="n">same</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="s1">'fo\027[31mo\027[m\008bar'</span></code></pre>

</div>
</div>
